================================================================================
         V4V SCENARIO FILE FORMAT - COMPLETE SPECIFICATION
================================================================================

1. FILE OVERVIEW
================================================================================

Magic Number:      0x0C 0x0C (constant signature)
File Extension:    .SCN (scenario files)
Byte Order:        Little-endian (Intel 8086/80386 format)
Text Encoding:     ASCII (null-terminated strings)

Key Observation:   Files contain three main sections:
                   1. Header & parameters (0x00 - 0x80)
                   2. Text strings (briefing, location names)
                   3. Unit/object records (variable-sized)


2. MAIN HEADER STRUCTURE (0x00 - 0x80)
================================================================================

Offset  Size  Name                    Type      Description
------  ----  -----                   --------  ---------------------------------
0x00    2     MAGIC                   WORD      Constant 0x0C0C
0x02    2     RESERVED_1              WORD      Always 0x0000
0x04    1     PADDING                 BYTE      0x00
0x05    1     VERSION                 BYTE      Scenario version (0-3 observed)
0x06    1     DIFFICULTY              BYTE      Difficulty/type (0-6 observed)
0x07    1     PADDING_2               BYTE      0x00

0x08    4     CONSTANT_FLOAT          DWORD     Always 0x40066666 (= 2.05 in IEEE)
0x0C    4     HEADER_VALUE_1          DWORD     Purpose varies by scenario

0x10    2     MAP_WIDTH               WORD      Approximate map width (44-90)
0x12    2     MAP_HEIGHT              WORD      Approximate map height (18-69)
0x14    2     PARAM_C                 WORD      Unknown parameter (0-54)
0x16    2     PARAM_D                 WORD      Unknown parameter (0-55)

0x18    2     FLAGS                   WORD      Data type flags (0x0000, 0x0101, 0x0303)
0x1A    2     OFFSET_1                WORD      Offset to first data section
0x1C    2     DATA_MARKER             WORD      Always 0x0001
0x1E    2     OFFSET_2                WORD      Offset to second data section

0x20    2     CONSTANT_MARKER         WORD      Always 0x0001
0x22    2     UNIT_PARAM_1            WORD      Unit/map parameter 1
0x24    2     UNIT_PARAM_2            WORD      Unit/map parameter 2
0x26    2     CONSTANT_PATTERN        WORD      Always 0x0101
0x28    2     RESERVED_2              WORD      Always 0x0000
0x2A    2     UNIT_COUNT              WORD      Possibly unit/point count (0-1000)

0x2C    68    RESERVED_3              PADDING   Reserved (0x00)

0x78-0x7F      DATA_REGION             Varies    01 01 01 01 patterns observed


3. TEXT SECTIONS (0x80 - ~0x800)
================================================================================

The file contains multiple text strings, each null-terminated and padded with
zeros to align to 128-byte boundaries.

Offset  Content                     Purpose
------  -------                     -------
0x80    Scenario briefing text 1    Main briefing/objectives
0x100   Scenario briefing text 2    Additional briefing
0x180   Scenario briefing text 3    More briefing information

Example from MGFIRST.SCN (0x80):
  "Commander, British 30th Corps has begun its dash to the heart"

Text strings continue with null padding until reaching structured data sections.


4. LOCATION/WAYPOINT RECORDS (starting ~0x880)
================================================================================

Each location record is EXACTLY 32 bytes.

Offset  Size  Name                    Type      Description
------  ----  -----                   --------  ---------------------------------
+0x00   2     PADDING                 WORD      0x0000
+0x02   2     X_COORDINATE            WORD      X position on map (little-endian)
+0x04   2     Y_COORDINATE            WORD      Y position on map (little-endian)
+0x06   2     UNKNOWN_VALUE_1         WORD      Purpose unknown
+0x08   1     STRING_TYPE             BYTE      String length indicator/type
+0x09   N     LOCATION_NAME           STRING    Location name (null-terminated)
+0x0A+  Pad   PADDING                 BYTE      Padding to 32-byte boundary

EXAMPLE RECORDS:

MGFIRST.SCN at 0x880:
  Record 1: 00 00 | 05 00 | 06 00 | 42 00 | 0a | "Zon" (padded to 32 bytes)
  Record 2: 00 00 | 07 00 | 43 00 | ?? 00 | 0a | "Driehoek" (padded to 32 bytes)
  Record 3: 00 00 | 01 00 | 46 00 | ?? 00 | 0a | "Best Bridge" (padded to 32 bytes)

UBCAMP.SCN at 0x880:
  Record 1: 00 00 | 0e 00 | 1e 00 | 18 00 | 12 | "Cherbourg" (padded to 32 bytes)
  Record 2: 00 00 | 38 00 | 44 00 | ?? 00 | 0e | "Carentan" (padded to 32 bytes)

Number of location records: ~6-12 per scenario (variable)


5. UNIT/OBJECT RECORDS (starting ~0x20000+ in larger files)
================================================================================

Each unit record appears to be 32 bytes, structured as:

Offset  Size  Name                    Type      Description
------  ----  -----                   --------  ---------------------------------
+0x00   2     PADDING                 WORD      0x0000
+0x02   2     X_COORDINATE            WORD      Unit X position
+0x04   2     Y_COORDINATE            WORD      Unit Y position
+0x06   2     UNIT_TYPE               WORD      Unit type identifier
+0x08   2     UNKNOWN_PARAM_1         WORD      Unknown parameter
+0x0A   2     UNKNOWN_PARAM_2         WORD      Unknown parameter
+0x0C   4     CONSTANT_MARKER         DWORD     Always 0x01010101
+0x10   16    UNIT_NAME               STRING    Unit designation/name (null-terminated)

EXAMPLE RECORDS from UBCAMP.SCN at 0x20090:

Record 1 (0x20090):
  00 00 | 4c 02 | 1e 00 | 15 00 | 06 00 | 21 00 | 01 01 01 01 | "Cherbourg"

Record 2 (0x200c0):
  38 00 | 42 00 | 00 00 | 11 00 | 00 00 | 00 00 | 01 01 01 01 | "Carentan"

Record 3 (0x20110):
  34 00 | 35 00 | 00 00 | 07 00 | 00 00 | 00 00 | 01 01 01 01 | "St. Mere Eglise"

Record 4 (0x20140):
  2c 00 | 51 00 | 00 00 | 04 00 | 00 00 | 00 00 | 01 01 01 01 | "Periers"

Number of unit records: Correlates with UNIT_COUNT field (0x2A)
  - UBCAMP.SCN: 1000 units
  - GJSCAMP.SCN: 544 units
  - GJSBEACH.SCN: 88 units


6. SECTION OFFSETS (from header 0x1A and 0x1E)
================================================================================

The offsets at 0x1A and 0x1E point to additional data sections that may
contain specific game data:

File Type 1 (MGFIRST.SCN - small scenarios):
  Offset 0x7ebe (32446): Small data section (~8 bytes), mostly zeros
  Offset 0x7ec6 (32454): Small data section (~8 bytes), mostly zeros

File Type 2 (GJSBEACH.SCN, UBCAMP.SCN - large scenarios):
  Offset 0x7c59 (31833): Active data section with structured records
  Offset 0x7c6f/0x7cf3: Additional data sections

Purpose: Likely contains HQ locations, victory condition points, or
         special location data indexed by the offset pointers.


7. END-OF-FILE STRUCTURE
================================================================================

The last 512 bytes contain structured data with repeating patterns:

Pattern: Repeated 0xa0 0x00 markers every ~16 bytes

This section appears to contain tile/terrain data or object records that
extend to the end of the file. The 0xa0 marker may indicate terrain type
or terrain feature markers.


8. FILE SIZE CORRELATIONS
================================================================================

Header Value Relationships:
- @0x10 (MAP_WIDTH): 44-90 range
- @0x12 (MAP_HEIGHT): 18-69 range
- @0x2A (UNIT_COUNT): 0-1000 units

File Sizes vs. Complexity:
  File                Size (bytes)    Ver Type  Units  Difficulty
  --------            -----------     --- ----  -----  -----------
  MGHELL.SCN          35,108           2  1      5     Easy
  MGFIRST.SCN         36,192           2  0      0     Easy
  MGEAGLES.SCN        42,068           ?  ?      ?     Medium
  GJSBEACH.SCN        92,306           3  2     88     Hard
  UBCAMP.SCN         132,878           0  5   1000     Very Hard
  GJSCAMP.SCN        118,454           3  6    544     Hard
  VLCAMP.SCN         134,440           1  6     27     Hard

Observation: File size correlates strongly with unit count and map size.


9. HEXADECIMAL DUMP EXAMPLES
================================================================================

MGFIRST.SCN Header (first 32 bytes):
  Offset  Hex Dump
  ------  ----------------------------------------------------------
  0x00    0C 0C 00 00 00 02 00 00 66 66 06 40 3B 00 00 00
  0x10    4A 00 12 00 08 00 07 00 00 00 BE 7E 01 00 C6 7E

UBCAMP.SCN Header (first 32 bytes):
  Offset  Hex Dump
  ------  ----------------------------------------------------------
  0x00    0C 0C 00 00 00 00 05 00 66 66 06 40 08 00 07 00
  0x10    5A 00 45 00 36 00 37 00 03 03 59 7C 01 00 F3 7C


10. NOTES FOR SCENARIO EDITOR IMPLEMENTATION
================================================================================

Critical Fields to Preserve:
  1. Magic number (0x0C 0x0C) - MUST be present
  2. Constant float at 0x08 (0x40066666)
  3. Constant markers at 0x20, 0x26 (01 00, 01 01)
  4. DATA_MARKER at 0x1C (0x01 00)
  5. Location record padding (32-byte alignment)
  6. Unit record padding (32-byte alignment)
  7. String null termination and padding

Variable Fields (Can be modified):
  - VERSION (0x05) - controls file behavior
  - DIFFICULTY (0x06) - maps to difficulty level
  - Location names and coordinates
  - Unit names and positions
  - Briefing text (limited by section size)
  - UNIT_COUNT (0x2A) - must match actual unit records

File Structure Constraints:
  - Text sections align to 0x80 (128-byte) boundaries
  - Location records are exactly 32 bytes each
  - Unit records are exactly 32 bytes each
  - Final section must maintain 0xa0 00 pattern integrity
  - File must end cleanly with proper padding

================================================================================
END OF SPECIFICATION
================================================================================
